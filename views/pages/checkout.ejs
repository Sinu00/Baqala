<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Planet Ecomm - Checkout</title>
  <link rel="stylesheet" href="../style/checkout.css">
  <link rel="stylesheet" href="../style/navbarstyle.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <%- include('../partials/navbar'); %>
  <main>
    <section>
      <div class="header">
        <button class="back-button">&larr;</button>
        <span>Cart</span>
        <span class="coupons">Coupons</span>
      </div>
    </section>
    <section class="seladdsec">
      <div class="dropdown-container">
        <button class="dropdown-toggle" onclick="toggleDropdown()">Select an address</button>
        <div class="dropdown-menu" id="addressDropdown">
          <% if (userCart.user.addresses.length >= 3 ) { %>
            <button class="addadressbtn" disabled>Reached address limit</button>
          <% } else { %>
            <button class="addadressbtn" onclick="openModal1('addAddressModal')">
              <i class="fa-solid fa-plus pr-3 pt-1"></i>Add Address
            </button>
          <% } %>
          <% userCart.user.addresses.forEach((address, index) => { %>
            <div class="dropdown-item" onclick="selectAddress(this)">
              <p>Address: <%= index + 1 %> | <%= userCart.user.name%> | <%= address.country %> | <%= address.streetAddress %></p>
            </div>
            <button class="edit-address-btn" data-address-id="<%= address.id %>">Edit</button>
            <button class="delete-address-btn" data-address-id="<%= address.id %>">Delete</button>
          <% }) %>
        </div>
      </div>
    </section>
    

    <!-- Add Address Modal -->
    <div class="modal" id="addAddressModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Add Address</h2>
          <button class="close-modal" onclick="closeModal('addAddressModal')">&times;</button>
        </div>
        <form id="userAddAddressForm">
        <div class="modal-body">
          <input type="text" class="form-control" id="name" name="name" value="<%= userCart.user.name %>" required>
          <input type="text" placeholder="Street Address" id="streetAddress">
          <input type="text" placeholder="City" id="city">
          <input type="text" placeholder="state" id="state">
          <input type="text" placeholder="Country" id="country">
          <input type="hidden" placeholder="Pincode" id="pincode" value=" " >
          <input type="hidden" id="userId" name="userId" value="<%= userCart.user._id %>">
        </div>

        <div class="modal-footer">
          <button class="cancel-button" onclick="closeModal('addAddressModal')">Cancel</button>
          <button class="save-button">Save</button>
        </div>
      </form>
      </div>
    </div>

    <!-- Edit Address Modal -->
<!-- Edit Address Modal -->
<div class="modal" id="editAddressModal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Edit Address</h2>
      <button class="close-modal" onclick="closeModal('editAddressModal')">&times;</button>
    </div>
    <form id="editAddressForm">
      <div class="modal-body">
        <input type="hidden" id="editAddressId"> <!-- Hidden input for address ID -->
        <label for="editName">Name</label>
        <input type="text" id="editName" name="editName" value="<%= userCart.user.name %>" required disabled>
        <div class="form-group">
          <label for="editCountry">Country:</label>
          <input type="text" id="editCountry" name="country" required>
        </div>
        <div class="form-group">
          <label for="editStreetAddress">Street Address:</label>
          <input type="text" id="editStreetAddress" name="streetAddress" required>
        </div>
        <div class="form-group">
          <label for="editCity">City:</label>
          <input type="text" id="editCity" name="city" required>
        </div>
        <div class="form-group">
          <label for="editState">State:</label>
          <input type="text" id="editState" name="state" required>
        </div>
        <div class="form-group">
          <label for="editPincode">Pincode:</label>
          <input type="text" id="editPincode" name="pincode" required>
        </div>
        <input type="hidden" id="editUserId" name="editUserId" value="<%= userCart.user._id %>">
          
        <input type="hidden" id="editAddressId" name="editAddressId" value="<%= userCart.user._id %>">
      </div>
      <div class="modal-footer">
        <button type="button" class="cancel-button" onclick="closeModal('editAddressModal')">Cancel</button>
        <button type="submit" class="save-button">Save Changes</button>
      </div>
    </form>
  </div>
</div>
<div id="snackbar"></div>
  </main>

  <script>
    // Toggle the dropdown
    function toggleDropdown() {
      document.getElementById("addressDropdown").classList.toggle("show");
    }

    // Select an address from the dropdown
    function selectAddress(element) {
      document.querySelector(".dropdown-toggle").textContent = element.textContent;
      document.getElementById("addressDropdown").classList.remove("show");
    }

    // Close dropdown when clicking outside
    window.onclick = function(event) {
      if (!event.target.matches('.dropdown-toggle')) {
        var dropdowns = document.getElementsByClassName("dropdown-menu");
        for (var i = 0; i < dropdowns.length; i++) {
          var openDropdown = dropdowns[i];
          if (openDropdown.classList.contains('show')) {
            openDropdown.classList.remove('show');
          }
        }
      }
    }
</script>
  
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  <script src="../js/coupon.js"></script>
  <script src="../js/orders.js"></script>
  <script src="../js/addUserAddress.js"></script>
  <script src="../js/checkout.js"></script>
  <script src="../js/updateAddress.js"></script>
</body>
</html>